const { ApiPromise, WsProvider } = require("@polkadot/api");
let provider = null;
let api = null;

const eventsHex = '0x6800000000000000c05a86090000000002000000010000003501d0070000bc0e5c430607e21a3e7cd8ec1f1e959492e721617063a2941d573a64167401d4ae8360548763dbb05c1c6b61276b6fe48d41ad967806f763ebfb9212772fd54fdd6197c2e4596c7c690c5e4a44b5955bfa088ab1433361eaf98b216d072a8f3235402f2a784b041b29379be887e79edac39bdba6a88ba6cca61d78c87dea8669d4fc94471e6c3edbca6225ccaa5abc987c85fa3d97ac39f6fb6af4c17bb7abfabe0a77e427331c08d14ae8ff65728e4558da104b9472b24a40632c2d9f49de5adcc6f49a50e77c6138e6e7fddd34d7616017d4110b855a4ab0580e568bbab780a110f70b1fd8d11e9409cb0d6790b69ee5bf14fbcb5d515228279feb9828b2b7ce864af51bd0b781efb619d2d7f5c360dc72c15ea0be3646823c62166fe6fa9f3b8c0345c5865ae78c7b2f132a760561be5bb9fb5236e39afe12bdaab986fb89e9021138355b8c37ec90a740ef4b2b08d4b90912f93a54825c5389b5c987823b5d914a7b33009417240ca4a3313feefc2aabc3f7abee89416db68c0908de8de9fae5bf1a8c4806e3efc49e14c54a403b117c20013c97474649ad8e3d1bb1173fc2982beaebf108066175726120afab1f0800000000056175726101016827ac1e29242d92f30d21a0d2263083275e759691496e3b060c5f22e298070bd949f9fd5b009783b9744f233a3256258777d18c2bf17441b2d436aefd27f98b010000001f000000000001000000350125080000bc0e5c430607e21a3e7cd8ec1f1e959492e721617063a2941d573a64167401d440ad6f169122d4ce19fa678695daace82d2794d26fb6cb852107d7ec8200267dab735a000403287c863159f2244fc36fc68e2cd20e0e61769d1c8bc0618eb8a10c2b48a19fb76391cbf616fa9f0e524a43cf1edf0b0e5908bccc0f5a9461621eec07733d726e7b7285301e07d0fc34d3478fc4f1e489d265a27ce232f0a5b79fd22ed7f8a443005585b75727450835c2785e78c0c0c5c7bfccf509a24572ac2e4e838c8c1f90824778a817411fee3024b74f9cc2dcfc7a40e3f872ce1b67e88a81a81138ffa4cd53907612da2aa1815e8584483302e35b0af11467dc33a1d6e991d949884c9bc067a7cfcd2ee808e89625035c5b1092ac483340957277bfaa4b681201e04c9bbb89fd2b34e744499295de6edaba6d62a83602f97ae7248baac0e90296a5c804102997a7b479f81447b4ede13df88a3d3dfbb2e22a996ae07743f018a60e080036563b626f28be164094b387a8a6c854124f54f2f9e08804e2bba879b29244b4eee068ae947aecd269961e3d06d04f6524be8789860e192193f05e2458b65bad08066175726120afab1f080000000005617572610101a2a2e67b79ba6ecc92c1e8fa29af601ba560e1e38551bf3aca7bdf9745b7284bf65a3e0c9b3260076920b51b16e81225dde7e9e7eae5772f0cb63654a8bbeb850700000025000000000001000000350128080000bc0e5c430607e21a3e7cd8ec1f1e959492e721617063a2941d573a64167401d4fe3db42f5cd8c4e2bef0f4da9f20768542750af7a5ff669695368cb41436825b25a2ab6389868f9fee2cdafc6da1b8a0c36364fc6fe0009cbfc65d7ce6408980e0f70be8b260dda19c5a6e61c925ab3db88d4c510c2e742fb4d72c313a1449814631c8826f4f16f035a2e352bb2ed96f09dc3acd7f2dd92be9c0ad23b4d9fd27c8c7304068d975276eb67d59155e8f1e323cb3d78736debd4cb76ed2be255870ec06502b4b70f1feace55517cb270f45425ff691cd0c419d0001f5d97d39ee8142548ddc9ebbd82ff9d9b0e1d12a5eebd8df34d8a145fe69e54f4bdefc7f79973cd446c9a1bd71d0ce47495a92d001a3047b17ea1afafade18e5892db4ebce47be157bef976ba18258641bc3890ef92b749ec5b393b7d3d52cac62feda109cabe902acb7c07841bffc32a90562303a0d97c58f290e1e4a3cf9da6a76c534a3d4cc22de830b00e0e1383810c3b50245dbae700cfaf19a1dd37ef0a618151b47c089916aa74fd81ad82da6cb01f60c090c35e41b1d6e8c0127c5711d74bb2670e45fc06af7070208066175726120afab1f0800000000056175726101015c5e46e18e15d6b2211dc68e55d208d76a7ddc1bbbe46f4cc90711e46bcaa41802be39449e609fac19a3437cc797114eb63f10df63094cb40a2a6f82c49a988409000000270000000000010000003500e8030000bed18343ca38b0943a4e8a236272d4dc9fc6361217f3a7cf7edd0418b50a6a0c4880e32ebd3b4c0cb4448579b3a5b47fd7a4db41aa75462cb7fb98404756e67e96b78feaf9fb1e5b928a1cb025ed654e66f399b0b03a09584849767304deed08710b2922c579e1d9e5598c79548de69a4f88d9e059a995bc217dad9d00d7426e052bcd8818859d0dfb7739e695be278c92205f945619b818bf31e7d24fd968635c8d5c1913ffbbd87cdc5043f71e8710822873aba28d8601ba45be74a7a7015ec111554f0d2bc1f950397c298818e075b5497762a94112a1d15e41a31d0ea28ca031a01ef3535bd6afad8206075be174298b415b95f15409a90a5675da0ba99c19755aae83cded7d2966ce2958195c5d02c6b8b625436c27cb0aae50f168c10890360400a3b2dc55599abf4ef4b45249e5639cedbedb6591ed0aba676f8ce717e90232654845c4e1f55883abd259c916e07478417cecf7d8c29974e604d2d3b997bee68840006016f9e759adebb7e39d9efebc947341aa0b47ede827d46e3e13e2a3bc831fec0b6419afef15fc51243148b431d56fa360e0168fb846e16090cb9cc0662449b008066175726120b0ab1f080000000005617572610101404b40632e5860afce036e861af56d62082a04d1773e7f5381574d8c95cc7334bcf84ef07dbc10e16e76f7adb852d7a01fcc2375d285509c001a8917362e6082000000001e0000000000010000003500d7070000bed18343ca38b0943a4e8a236272d4dc9fc6361217f3a7cf7edd0418b50a6a0c8e612770d288021d4720e562824df72d041b473704fb2eb516fa99d5f447634997a236fc6017e516ba5f77dede144b21d1394bcf50b9bddee85414abad071c1c2afc9b18a3adb3b8b4bffa430e66180d816b097746f7ac15542c0fea746ef18d73da51dd670df5159ed568452f80ab1b1470d1e6e47b488b5e8851432a2b17f8e89836b24ec0abf9636a6d2cae63b665ca8d2b7b8a231295fe366b39d78eff66b0a09ca5a344c6c534d84ec056e19e7220ce6d030121e70aa1bed76f5b941f85aeaeb23814920b3d27956fcc6a12af1ac0e3a58810b516aecf6c3e1351781937683f98ff457b3c96db562a242dc127d65e8f3a5230e4605a4f37040d471fcea97265bfab732ed9277aac7fead2567c141def9631aaafa69502fbf7eb5cff76c30d043f015b7e550bb073ad8b09d396777b4669681ef06c40f1bebb6bcddd408a5da426b92300bfd823a672ddcd91ee54527428dbbf8c00cddbf3262d9bc91eaba13ee7aefe96881858c69e96a9d057e7b0fae96957ee33c92a9753fe0cbd78f0c65d8711f50d0c066175726120b0ab1f08000000000466726f6e0901019314e78f2aa2b10995a544188f073765196ddd514f8f61120c61bb7c4b8c2d0604d14e1d74ba1b3df3b6e97a82d156a18a41d1486ec770f406ca8ffc3fe7faa31a05617572610101de80a56be41156dc7e8d47d5764d0499c61e1d36960ea2541bd9aca522e9a52fa549d8771a528ce7d231c042a05b4d796b950bdd2f1191f9b33ddcdc2091848404000000220000000000010000003500e7070000bed18343ca38b0943a4e8a236272d4dc9fc6361217f3a7cf7edd0418b50a6a0cc469a1ace526f373a20899784ffb091518e4e86215ccf9ca101026836297024b65a08a92c3a340f8f5bf407da37aca8f4683a8bb8474151c4a20f3187e9d211d3f8c6f5843e85d7d38af22f49d19eb315d08afa7e65913c70f0c1d81b34adb72cf83052462b118f9d774e512544db00adb220df4282b956b1ff68be5dd27e2625454cd5cdd7e2bad650d998fc46b2fc46defbeab66a3ad084dc8f3e3cb17e131e7cda08830ce400dc485703271fdb74456410291cf15e6079648b4a21b8dd28bac585bbf88e934d2c5145ce911ff2a79c70039eb75dd62351d2eb6a82e2fa76f0bbf598709dfaf0c0bfa61665689f678659ef14f2f8db75dfced6e0c3cdbc7eaee3a8ff38efa112ad5f03ee29d16c3c5f76f4f3d5c0041c12552e49350579b02ed06a6fe4c836e35333c058b1fdbbcadc2cce344794044ae21373c6109bda4cc3cd1e6cd310027e1f2d009104b1185119f247fd82f5717a892f4dd8a9acbf95dfb41b650889a4f16671e517190c2b3e34e2ee513c15c466ded37ac816e6dd3a8c41b252a406e0c046e6d627380f489c437f0f9ed98376aea63d9bbbfb90cda80812dc3d9473be291c70a9db60a0466726f6e890301b7eb5843d0d78bc4bc02e90beacdf34e1d97312e81663559bfe91f09f2dbe77918147d28df93db7bae05ab307ce643fc41c9136d9128ad4b67935e6facf55119810407672fe566949e2a4e268daff35de6b47e8f182d2c35cb76316e7d3efd47f05fb9779fe184c66e44572561c0362aa92d1c9d79e0240c86fd3912a6e7dd7b0e4a33e29d62280070d70a3af011200d04608c8722c04bd24fd873fdf254ddbe9f368c4807fe6116ac7edd302a2635cbd6f3628c734fdc1472e9a56ce710d35e22ba206b9b10cce14e3fb9e19f3467fc2223dcc41da86935d3a6edb8e246484e8a056e6d6273010150ba4895f049f3be8795655755049ec9f8392afbad5f3384b585f9f8f512a9588dab4824fcd80f749d0c4c983b9f371900433f4a85ed1fc99cde5e382d2f488b0500000023000000000001000000350024080000bed18343ca38b0943a4e8a236272d4dc9fc6361217f3a7cf7edd0418b50a6a0c2a4e39c652e40a3203f0fcf0db620cc581fe9d02a93dc64eac3691949a5dbe6dc9d3d7eda73fa7b085507f4af4c0390fde7574fbec06566a9abc68d6a014b33075006d07c5b4f0492120188ef541c2a8af6817a7a00dcac145ab5c714702b5fdb454769e520ed76dbdcd5538cd31c1c3ac4012feef526458c2f753562e0c551a0436d1155c1b32ad52f48885ca6a9793a9c9cd787c1b9553dd50ab7bc24df10928b2709163b1cbc975e57f8781480e372180b0036a3225688ff5af707f379d82279932023ab071c7b441e795332c69214a878f3db20e0a690cc131ef2538c01feb7c5a7fdac2b8971e1bde37903abdaea98d21356828bd5e19799f2c982a64ee36c3dedc3fd75e006441100323c77077fa65996f35bf46686bb5f316ebaa6598e902039b037c022238ad7ccd62943253ff139a0cf561ce1000264246f372afd8734fe22711004c1d21c5e6f61cbbed21ce57925115661e2ff7ec726027d05c3fac4aa649c4b9966e3c792df0d4a043f08ea51276f21f2233ab0ca0aa56e9c11772ffeb3fef1008066175726120b0ab1f080000000005617572610101dc429568e32429e193f0b943d9f532d4fa49569e636200e71dc2d78197a794338c8cec595d886e38feece19f5d3b7105316bcab08a06ac7ef690b2f7083546840600000024000000000001000000350026080000bed18343ca38b0943a4e8a236272d4dc9fc6361217f3a7cf7edd0418b50a6a0c3e65d2872dfe3bb25678d64f478de9a687ceafde4748f891949f4a07867f426a8b9e6005ac2796e51da1900cdd8289573a2e01c5b154e614c5f6d68c0b684ff2077512f16e4b6c3406e67cf79e844582400096d46ee073f431ca395898c000314980e5977e4fc849abb9f43e04cb307d7e0eb2c07e1c24e24da59c061990415bf2c9989e4ea37156c84e1f6dff7d0e01d4b99851cbe87181e313f23f462966053db4ab9b5b2da8bc22136c0e95d5d0e50571a80b156b688b5f7a8d3d7639c2855b95c3992f88d01d879d64ac856253188f97450a9dc4fa7aa0a9d7964cb44250f5ed0e0391aa175c1de03dff710a6708c394e02562939c08c498be3f93372009d5c71d782e78b6cd7181f3cc76af78a207a14dd518afc9f846b63bbaa614da2ae902e68153aac53762745b49ee66e68041665bc0ae70e32a065ca3f487d83698f893b27913001c82673f23abc44cbfa5832d9172fc94cc638c09a776cc8af0befee1120c32b7f04965a9b95ec7bb23443a53a70c0d89183dbb90e1092047dcb7df40e5d41b1508066175726120b0ab1f080000000005617572610101d8732f8fbd31eca238bc2aa6254090fa689af7fbc4f37b415520ca75a0a6065f13772292ac60fb5ccd212f220a5ab4fa8415f07bb2dcaa99f5bf76c906ea988d080000002600000000000100000035002a080000bed18343ca38b0943a4e8a236272d4dc9fc6361217f3a7cf7edd0418b50a6a0c94f5864f742c4423058af316996cb1c13769f6303b3dd593fa3392b6ac896412013b939585f64f5c5fb2dc6869259e81b11776dd37808d3e0a7e6e4403adbfa1d27d575444769887b66303c7d1b03e8b38912cacb0f92321c9b215cfbf63f2e17925a96525444f7619cfe02e1ae3bff8ff95ed5279d211e598609751459feab0b8be75dec0f6cd28550327a0371cd63f8dbd261a9ed8839b26f583ecc1be5744a2895f57a48d8f20f0e955c2a9283cd199aa8e5934a84312dda9aab29d803d882dbbb68c47282e0537f5d8b3ea684f8377a922e745fe68fef5aa1cc9ef3714c7799e6a8d1d9d46d138dc42fef1895d04014673793f17f350ad8b3d8d359c1f34d49f5a8313478ea4f8c726a4df5e4eb37ae6057c783a646de13d8f654530359de902fa260d79d9045ebb7383276e9ef9372e6cc296ad5a47586d260f4eddc38dd893fa1c0d0039c247649e8390cb6cf2294b0c2663b35dc4723526c39e5c7e1c8641f4cfa02728cebdc75b53d2d81846229be9679505a627f42d8b7d38b75bc93681ae0f02c308066175726120b0ab1f0800000000056175726101019c87f0ad33dc6988346364d86ea91fb626d5afb4be3e831695e6cfee10634d6f390487d934c6f62bbb165a9d95a65e03560037f833e667e969507a68aea8ab850a00000000000000000001000000000040daef0e0000000002000000020000000b0082a2ca6ce0c906f7d58b64f7e579c9be4c241dd0760560e590502d2f1bd56235000002000000000018cd501a0000000000000000030000000b00a6e91403261ac263f04d2ee273e754a1329a7e14c855edb57a9774c254aee903000003000000000018cd501a0000000000000000040000000b00a25fbf5ee3c89448fc26d6323ae67a82a13364e3445c91ee98e240adf612ee33000004000000000018855c1a000000000000000005000000040290bdaa0957f9a700fd5cefa0e3d78c9a43c3c82d9d7ba4eff30410358bc6176aea9aadc165ec3eb65a9bf6370d56f3824352928a7babf63c897c0b96a8cffa45002ca07d51000000000000000000000000000500000012067dc27a020000000000000000000000000000050000000404d203b04d53f87c32f8d5ce5339d3cd6f8bd6339dbb405f784000a0e5ef33e964a0b09e000000000000000000000000000000050000000000d8cbab0a00000000000000000600000004022e102b0f350e1e7593ec066e931dc18418852a48e89e21750e02a97baba253696d6f646c70792f6366756e64270800000000000000000000000000000000000090888422dd020000000000000000000000000600000049012e102b0f350e1e7593ec066e931dc18418852a48e89e21750e02a97baba253692708000090888422dd0200000000000000000000000006000000120685c204020000000000000000000000000000060000000404d203b04d53f87c32f8d5ce5339d3cd6f8bd6339dbb405f784000a0e5ef33e964a23081000000000000000000000000000000060000000000785f883600000000000000'
const blockHash = '0x7df94278dc6c1ca0a120441d7979fdc04efef0a3e89d74067bccd07e6e6eea4c';

const defaultKsmEndPoint = "wss://kusama-rpc.polkadot.io";

async function getApi() {
  if (!api) {
    provider = new WsProvider(defaultKsmEndPoint);
    api = await ApiPromise.create({ provider });
  }

  return api;
}

const version = {
  "apis" : [
    [
      "0xdf6acb689907609b",
      3
    ],
    [
      "0x37e397fc7c91f5e4",
      1
    ],
    [
      "0x40fe3ad401f8959a",
      5
    ],
    [
      "0xd2bc9897eed08f15",
      3
    ],
    [
      "0xf78b278be53f454c",
      2
    ],
    [
      "0xaf2c0297a23e6d3d",
      1
    ],
    [
      "0x49eaaf1b548a0cb0",
      1
    ],
    [
      "0x91d5df18b0d2cf58",
      1
    ],
    [
      "0xed99c5acb25eedf5",
      3
    ],
    [
      "0xcbca25e39f142387",
      2
    ],
    [
      "0x687ad44ad37f03c2",
      1
    ],
    [
      "0xab3c0572291feb8b",
      1
    ],
    [
      "0xbc9d89904f5b923f",
      1
    ],
    [
      "0x37c8bb1350a9a2a8",
      1
    ]
  ],
  "authoringVersion" : 2,
  "implName" : "parity-kusama",
  "implVersion" : 0,
  "specName" : "kusama",
  "specVersion" : 9122,
  "transactionVersion" : 7
}

async function findRegistry(hash) {
  const api = await getApi()
  return (await api.getBlockRegistry(hash, version)).registry;
}


async function main() {
  await getApi();
  const registry = await findRegistry(blockHash);

  try {
    const allEvents = registry.createType(
      "Vec<EventRecord>",
      eventsHex,
      true
    );

    console.log(allEvents)
  } catch (e) {
    console.error(e)
  }
}

main()
